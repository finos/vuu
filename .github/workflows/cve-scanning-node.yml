name: Node CVE Scanning

on:
  push:
    paths:
      - '**/package.json'
      - '.github/workflows/cve-scanning-node.yml'
      - 'allow-list.json'

jobs:
  scan:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16.x]
        package-folder: [vuu-ui/packages/app, vuu-ui/packages/data-remote, vuu-ui/packages/data-types, vuu-ui/packages/shell, vuu-ui/packages/layout, vuu-ui/packages/utils, vuu-ui/packages/datagrid-parsers, vuu-ui/packages/parsed-input, vuu-ui/packages/app-vuu-example, vuu-ui/packages/react-utils, vuu-ui/packages/data-source, vuu-ui/packages/data-store, vuu-ui/packages/theme, vuu-ui/packages/ui-forms, vuu-ui/packages/theme-uitk, vuu-ui/packages/showcase, vuu-ui/packages/electron, vuu-ui/packages/ui-controls, vuu-ui/packages/data-grid ]
    steps:
      - uses: actions/checkout@v3
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
      - run: npm install
        working-directory: vuu-ui
      - run: npx --yes auditjs ossi --whitelist allow-list.json
        working-directory: vuu-ui
      - run: npm install ; npx --yes auditjs ossi --whitelist ../../allow-list.json
        working-directory: ${{ matrix.package-folder }}
